# CTRL Algorithm Applied to Imagenet

This repository provides an augmented version of the [PyTorch ImageNet training code](https://github.com/pytorch/examples/tree/main/imagenet), three ImageNet noisy data masks, and three ImageNet label corrections. 

## Using the Training File (main.py)

This is the same training code as the original PyTorch training code, but with augmentations for loss recording, masked training, and corrected training. New command line arguments are detailed below: 

`--record-losses DIRECTORY` - Enables loss recording, placing data in the specified directory. DIRECTORY must be an existing folder. Data for each epoch will be placed in a file named `epoch_EPOCH_NUM`, which will be a json dictionary mapping each image name to the loss value (a total of `SAMPLE_NUM` samples). Note that this will significantly slow down training, as we loop through the entire training set twice instead of just once. 

`--mask MASK_PATH` - Use of this parameter enables masking with simple removal. See Masks section for formatting of mask file. 

`--dynamic-mask MASK_PATH` - Use of this parameter enables masking with dynamic replacement. See Masks section for formatting of mask file. 

`--corrections CORRECTIONS_PATH` - Use of this parameter enables training with corrections. This allows for removal of samples and replacement of sample labels. See Corrections section for formatting of corrections file. 

`--val-corrections CORRECTIONS_PATH` - Use of this parameter enables validation with corrections. This allows for removal of samples and replacement of sample labels. See Corrections section for formatting of corrections file. 

`--dynamic-frac-start FRAC` -  Sets the first epoch (as a proportion) for dynamic training label replacement to begin. Default is 0.5.

`--dynamic-frac-end FRAC` -  Sets the last epoch (as a proportion) for dynamic training label replacement to occur. Default is 0.9.

## Masks

There are three mask files in the `masks` folder, one which filters 2.79% of ImageNet samples, one which filters 3.94% of samples, and one which filters 5.53% of samples. The files are each a list of sample names to be filtered (no file extension) separated by newlines. 

## Corrections

There are three corrections files in the `corrections` folders. One is an ImageNet training set corrections set generated by a pretrained ConvNext-Large model, one is a correction set generated by ResNet101 on our clean data, and one is a correction set for the validation set based on the paper by Northcutt, Athalye, and Mueller (2021). 

The corrections are json files, each holding one dictionary with two keys. The `remove` key provides a list of sample names to be removed, and the `replace` key provides a dictionary which gives a mapping from select sample names to new label ids. 